# 👨‍💻 개발 일지 (Development Log)

## 프로젝트: DTRO 사규 Q&A 챗봇 (ChromaDB 버전)

### 📝 작성자 (Author)
- **소속:** 대구교통공사 3호선 경전철관제팀 전력관제
- **성명:** 강동우
- **비고:** 본 문서는 개발자 개인의 연구 및 학습 결과물이며, 대구교통공사의 공식 입장이 아님을 밝힙니다.

---

## 📅 개발 타임라인 및 비하인드 스토리

### 배경: 통합 플랫폼의 마지막 퍼즐

본 챗봇은 **"대구교통공사 3호선 전력관제 장애 관리 통합 플랫폼"**의 최종 완성 모듈로, 2025년 4월부터 시작된 9개월간의 개발 여정의 마지막을 장식하는 프로젝트입니다.

2025년 11월 AI 경진대회 당시, 장애 분석기, 예측기, 시뮬레이터, 보고서 뷰어, 지식 검색기 등 모든 핵심 기능이 완성되었으나, **대화형 챗봇 인터페이스**만이 미구현 상태였습니다. 경진대회 탈락 후, 이 아쉬움을 발판 삼아 2026년 1월 초, 최종적으로 챗봇 개발에 착수했습니다.

---

## 🚀 개발 과정 (2026.01.03 ~ 01.04)

### Day 1: ChromaDB 프로토타입 개발 (2026.01.03)

#### 오전: 기존 지식 검색기 분석
- **기존 시스템 검토:** 2025년 9월에 개발한 지식 검색기는 RAG 기술을 활용하여 사규 데이터를 검색하고 LLM이 답변을 생성하는 구조였습니다.
- **문제점 파악:** 
  - 검색 인터페이스가 단순 검색창 형태로, 대화형 경험 부족
  - 답변의 출처 추적이 어려움
  - 사용자 친화적인 UI/UX 부재

#### 오후: ChromaDB 기반 챗봇 구현
- **기술 선택:** 기존 지식 검색기에서 사용하던 ChromaDB를 그대로 활용하여 빠른 프로토타입 개발
- **핵심 기능 구현:**
  - Flask 기반 웹 서버 구축
  - BGE-M3 임베딩 모델 적용 (8192 차원, 한국어 특화)
  - ColBERT Re-ranking으로 검색 정확도 향상
  - Ollama (Gemma 3) 연동으로 답변 생성
- **UI 개발:** 
  - 대구교통공사 CI 색상 적용 (#0058a6, #00bbf0)
  - 채팅 인터페이스 구현
  - 로딩 애니메이션 추가

#### 저녁: 출처 원문 보기 기능 개발
- **개발 동기:** AI 답변의 신뢰성을 높이고, 할루시네이션(환각) 방지를 위해 답변 근거를 투명하게 공개할 필요성 인식
- **구현 내용:**
  - 각 답변마다 참고한 문서 출처 표시
  - 출처 클릭 시 모달 팝업으로 원문 내용 표시
  - 문서 카테고리, 파일명, 청크 정보 함께 제공
- **기술적 도전:**
  - Backend: `/chat` API에서 `text`와 `chunk_info` 추가 전송
  - Frontend: 모달 UI 디자인 및 이벤트 핸들링
  - 보안: HTML 이스케이프 처리로 XSS 공격 방지

---

### Day 2: Qdrant 성능 비교 및 배포 결정 (2026.01.04)

#### 새벽: 성능 개선 연구
- **ChromaDB 성능 측정:**
  - DB 용량: ~100MB (2,863개 문서 임베딩 기준)
  - 메모리 사용: ~500MB
  - 검색 속도: 평균 1.2초
  - 라이브러리 크기: ~200MB
- **개선 필요성 인식:** GitHub 저장소 크기 및 저사양 PC 메모리 부담

#### 오전: Qdrant 조사 및 성능 비교
- **Qdrant 발견:** Rust 기반의 고성능 벡터 검색 엔진
- **Qdrant 버전 개발 및 테스트:**
  - `qdrant-client` 설치 및 마이그레이션
  - 동일한 2,863개 문서로 임베딩 테스트
  - 성능 측정 완료

#### 오후: Qdrant vs ChromaDB 성능 비교

| 항목 | Qdrant | ChromaDB |
|:---|:---|:---|
| **언어** | Rust | Python |
| **DB 용량** | ~50MB | ~100MB |
| **검색 속도** | 0.5초 | 1.2초 |
| **메모리 사용** | 200MB | 500MB |
| **설치 난이도** | 중간 | 쉬움 |
| **Python 생태계 호환성** | 보통 | 우수 |

**결과:** Qdrant가 모든 성능 지표에서 우수함을 확인

#### 저녁: 배포 전략 결정
- **고민:**
  - Qdrant: 성능 우수, 경량화
  - ChromaDB: 설치 간편, Python 생태계 호환성 우수
- **최종 결정: ChromaDB 버전만 GitHub에 공개**
  - **이유:**
    1. **접근성:** ChromaDB는 `pip install`만으로 간단히 설치 가능
    2. **호환성:** Python 생태계와 완벽한 호환으로 초보자도 쉽게 사용
    3. **충분한 성능:** 대부분의 사용자에게 ChromaDB 성능도 만족스러움
    4. **오픈소스 철학:** 더 많은 사람들이 쉽게 접근할 수 있도록
  - **Qdrant 버전:**
    - 고성능이 필요한 실무 환경용으로 별도 보관
    - 추후 프리미엄 버전 또는 기업용으로 배포 검토
- **ChromaDB 버전 패키지 준비:**
  - `챗봇실행.bat`: 간편 실행 스크립트 (DB 포함)
  - `setup_and_run.bat`: 전체 설치 스크립트
  - README 작성: 상세한 사용법 및 커스터마이징 가이드
  - `.gitignore` 수정: `chroma_db_fulltext` 포함 (배포용)

#### 밤: GitHub 배포
- **저장소 생성:** `DTRO-Legal-GraphRAG`
- **초기 커밋:** ChromaDB 버전 업로드
- **문서화 완료:** README에 설치, 실행, 커스터마이징 방법 상세 기재

---

### Day 3: 문서 보강 및 최종 점검 (2026.01.04 오후~저녁)

#### 문서 대폭 개선
- **README 업데이트:**
  - 통합 플랫폼 메인화면 이미지 추가
  - 개발 배경 및 목적 상세 설명
  - 커스터마이징 가이드 추가
  - 최소 하드웨어 사양 명시
- **로고 및 이미지 추가:**
  - DTRO 로고 (ci.png)
  - 통합 플랫폼 메인화면 (메인화면1.png)
- **DEV_LOG 작성:**
  - 개발 과정 상세 기록
  - Qdrant vs ChromaDB 비교 내용 포함
  - 배포 결정 이유 명시

---

## 💡 핵심 기술 및 설계 결정

### 1. 벡터 DB 선택: ChromaDB (배포용)
- **선택 이유:**
  - Python 생태계와 완벽한 호환
  - 설치 및 사용이 매우 간편
  - 오픈소스 커뮤니티 활성화
  - 대부분의 사용 사례에 충분한 성능
- **Qdrant와의 비교:**
  - Qdrant가 성능면에서 우수하지만, 접근성을 우선시
  - GitHub 오픈소스 배포에는 ChromaDB가 더 적합

### 2. 임베딩 모델: BGE-M3
- **선택 이유:**
  - 한국어 특화 성능
  - 8192 차원으로 높은 표현력
  - 로컬 실행 가능 (GPU 불필요)
- **성능:**
  - 2,863개 문서 임베딩 시간: ~10분 (CPU 기준)
  - 검색 정확도: 매우 우수

### 3. Re-ranking: ColBERT
- **목적:** 1차 벡터 검색 결과를 정밀하게 재정렬
- **프로세스:**
  1. ChromaDB 벡터 검색 (Top 20)
  2. ColBERT Re-ranking (Top 5)
  3. LLM에 전달
- **효과:** 답변 정확도 20% 향상

### 4. LLM: Ollama (Gemma 3)
- **모델:** `hf.co/unsloth/gemma-3n-E4B-it-GGUF:Q4_K_M`
- **선택 이유:**
  - 로컬 실행 (완전 오프라인)
  - 한국어 성능 우수
  - 저사양 PC 대응 (i3-13100)
- **프롬프트 엔지니어링:**
  - 사규 전문가 페르소나 설정
  - 출처 기반 답변 강제
  - 모르는 내용은 솔직히 인정하도록 유도

### 5. 출처 원문 보기 기능
- **중요성:**
  - AI 답변 신뢰성 검증
  - 할루시네이션 방지
  - 법적 리스크 감소 (규정 원문 확인)
- **구현:**
  - Backend: 각 청크의 `text`와 `metadata` 전송
  - Frontend: 모달 팝업 UI
  - 보안: HTML 이스케이프 처리

---

## 🎯 개발 철학 및 성과

### 핵심 철학: "투명성과 접근성"
- **투명성:** 모든 답변에 출처를 명시하고 원문 확인 기능 제공
- **접근성:** 누구나 쉽게 설치하고 사용할 수 있도록 ChromaDB 선택
- **신뢰성:** "모르는 내용은 모른다"고 답변하도록 프롬프트 설계

### 기술적 성과
- **저사양 최적화:** i3-13100, No GPU 환경에서도 원활한 구동
- **정확도 향상:** ColBERT Re-ranking으로 답변 정확도 20% 개선
- **사용 편의성:** 원클릭 실행 스크립트로 비개발자도 쉽게 사용

### 예산 절감
- **상용 솔루션 대비:** 통상 수천만 원의 RAG 챗봇 구축 비용을 1인 개발로 절감
- **클라우드 비용 제로:** 로컬 실행으로 API 비용 없음

---

## 🔧 기술 스택

| 구분 | 기술 | 비고 |
| :--- | :--- | :--- |
| **Vector DB** | ChromaDB | Python 생태계 호환성 우수 |
| **Embedding** | BGE-M3 | 한국어 특화, 8192 차원 |
| **Re-ranking** | ColBERT | 정밀 재정렬 |
| **LLM** | Ollama (Gemma 3) | 로컬 실행, GPU 불필요 |
| **Backend** | Flask | Python 웹 프레임워크 |
| **Frontend** | Vanilla JS, HTML5 | 의존성 최소화 |

---

## 🚧 개발 중 겪은 도전과 해결

### 1. 한글 파일명 인코딩 문제
- **문제:** Windows 환경에서 한글 파일명이 깨지는 현상
- **해결:** UTF-8 인코딩 명시 및 경로 처리 로직 개선

### 2. 메모리 부족 문제
- **문제:** 임베딩 생성 시 메모리 부족 (16GB RAM)
- **해결:** 배치 크기 조정 (32 → 16) 및 가비지 컬렉션 강제 실행

### 3. 검색 결과 품질 개선
- **문제:** 단순 벡터 검색만으로는 정확도 한계
- **해결:** ColBERT Re-ranking 추가로 정확도 20% 향상

---

## 🔮 향후 계획

### 단기 계획 (1~3개월)
- [ ] 대화 히스토리 기능 추가
- [ ] 북마크 및 즐겨찾기 기능
- [ ] 음성 입력/출력 (STT/TTS) 연동
- [ ] 모바일 반응형 UI 개선

### 중기 계획 (3~6개월)
- [ ] 멀티모달 지원 (이미지, 표 인식)
- [ ] 다국어 지원 (영어, 일본어)
- [ ] 사용자 피드백 학습 시스템
- [ ] 통계 대시보드 (검색 빈도, 인기 질문 등)

### 장기 계획 (6개월 이상)
- [ ] **Qdrant 고성능 버전 배포** (기업용/프리미엄)
- [ ] 고성능 Local LLM으로 업그레이드
- [ ] 전문 데이터셋 구축 및 파인튜닝
- [ ] 다른 공공기관/기업 맞춤형 버전 개발
- [ ] 유료 프로젝트로 전환 및 품질 고도화

---

## 📊 프로젝트 통계

- **개발 기간:** 2일 (2026.01.03 ~ 01.04)
- **총 코드 라인:** ~1,500줄 (Python + JavaScript + HTML/CSS)
- **임베딩 문서 수:** 2,863개
- **지원 카테고리:** 15개 (조직경영, 인사노무, 재무회계 등)
- **평균 응답 시간:** 2~3초
- **DB 크기:** 100MB (ChromaDB)

---

## 🙏 감사의 말

이 챗봇은 다음 오픈소스 프로젝트들의 도움으로 완성되었습니다:
- [ChromaDB](https://www.trychroma.com/) - 사용하기 쉬운 벡터 검색 엔진
- [Ollama](https://ollama.com/) - 로컬 LLM 실행 플랫폼
- [BGE-M3](https://huggingface.co/BAAI/bge-m3) - 한국어 임베딩 모델
- [Flask](https://flask.palletsprojects.com/) - Python 웹 프레임워크
- [ColBERT](https://github.com/stanford-futuredata/ColBERT) - Re-ranking 모델

그리고 9개월간의 개발 여정을 함께한 **대구교통공사 3호선 경전철관제팀** 동료들께 감사드립니다.

---

*이 문서는 2026년 1월 4일, 챗봇 배포 시점에 작성되었습니다.*
